<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Workout Rest Timer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" href="https://via.placeholder.com/180" />
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen;
            text-align: center;
            background: #121212;
            color: #f1f1f1;
            margin: 0;
            padding: 2em;
        }
        h1 {
            font-size: 1.8em;
            margin-bottom: 0.2em;
        }
        .version {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 1.5em;
        }
        .btn {
            display: block;
            width: 90%;
            margin: 0.6em auto;
            padding: 1.2em;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            background-color: #1E88E5;
            color: white;
            transition: background-color 0.3s ease;
        }
        .btn:hover {
            background-color: #1565C0;
        }
        .btn-reset {
            background-color: #ff1744;
        }
        .btn-reset:hover {
            background-color: #d50000;
        }
        #timer {
            font-size: 3em;
            margin-top: 1.5em;
            color: white;
            padding: 10px;
            border-radius: 8px;
            background-color: #1b5e20;
            transition: background-color 0.4s ease;
        }
        .yellow {
            background-color: #fbc02d !important;
        }
        .red {
            background-color: #d32f2f !important;
        }
    </style>
</head>
<body>
    <h1>Rest Timer</h1>
    <div class="version">Version 1.1.0</div>

    <button class="btn" onclick="startTimer(30)">30s (Superset / Drop Set)</button>
    <button class="btn" onclick="startTimer(45)">45s (Isolation Set Recovery)</button>
    <button class="btn" onclick="startTimer(60)">60s (Standard Set Rest)</button>
    <button class="btn" onclick="startTimer(90)">90s (Heavy Set Recovery)</button>
    <button class="btn" onclick="startTimer(120)">2 min (Compound Lift Rest)</button>
    <button class="btn" onclick="startTimer(180)">3 min (Rest Between Exercises)</button>
    <button class="btn btn-reset" onclick="resetTimer()">Reset Timer</button>

    <div id="timer">00:00</div>

    <script>
        const version = "1.1.0";
        const storedVersion = localStorage.getItem("timerAppVersion");
        if (storedVersion !== version) {
            localStorage.setItem("timerAppVersion", version);
            location.reload(true);
        }

        const timerDisplay = document.getElementById('timer');
        let countdown;
        let wakeLock = null;
        let totalTime = 0;

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                }
            } catch (err) {
                console.error('Wake Lock failed:', err);
            }
        }

        function startTimer(seconds) {
            clearInterval(countdown);
            requestWakeLock();
            totalTime = seconds;
            const endTime = Date.now() + seconds * 1000;

            function updateTimer() {
                const now = Date.now();
                const remaining = Math.max(0, endTime - now);
                const minutes = Math.floor(remaining / 1000 / 60);
                const secs = Math.floor((remaining / 1000) % 60);
                timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;

                const percentLeft = remaining / (totalTime * 1000);
                timerDisplay.classList.remove("red", "yellow");
                if (percentLeft <= 0.10) {
                    timerDisplay.classList.add("red");
                } else if (percentLeft <= 0.6) {
                    timerDisplay.classList.add("yellow");
                }

                if (remaining <= 0) {
                    clearInterval(countdown);
                    if (wakeLock) {
                        wakeLock.release();
                        wakeLock = null;
                    }
                }
            }

            updateTimer();
            countdown = setInterval(updateTimer, 1000);
        }

        function resetTimer() {
            clearInterval(countdown);
            timerDisplay.textContent = "00:00";
            timerDisplay.classList.remove("red", "yellow");
            if (wakeLock) {
                wakeLock.release();
                wakeLock = null;
            }
        }
    </script>
</body>
</html>
